/* Alterando uma Trigger */
ALTER TABLE
	BACKUP.BKP_PRODUTO
ADD
	EVENTO CHAR(1);
	

/* Apagando uma Trigger */
DROP TRIGGER
	BACKUP_PRODUTO_DEL;
	
	
/* Criando uma Trigger */
DELIMITER $$
CREATE TRIGGER
	BACKUP_PRODUTO_DEL
BEFORE DELETE ON
	PRODUTO
FOR EACH ROW
BEGIN
	INSERT INTO
		BACKUP.BACKUP_PRODUTO_DEL
	VALUES (
		NULL,
		OLD.IDPRODUTO,
		OLD.NOME,
		OLD.VALOR,
		'D');
END
$$

DELIMITER ;


/* Apagando Banco de Dados */
DROP DATABASE
	BACKUP;
	

DROP DATABASE
	LOJA;
	
	
/* Criando um Banco de Dados */
CREATE DATABASE
	LOJA;
	
	
/* Escolhendo um Banco de Dados */
USE
	LOJA;
	
	
/* Criando uma Tabela */
CREATE TABLE PRODUTO (
	IDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30),
	VALOR FLOAT(10,2)
);


INSERT INTO
	PRODUTO
VALUES (
	NULL,
	'LIVRO MODELAGEM',
	50.00
);


INSERT INTO
	PRODUTO
VALUES (
	NULL,
	'LIVRO BI',
	80.00
);


INSERT INTO
	PRODUTO
VALUES (
	NULL,
	'LIVRO ORACLE',
	70.00
);


INSERT INTO
	PRODUTO
VALUES (
	NULL,
	'LIVRO SQL SERVER',
	10.00
);


/* Criando um Banco de Dados */
CREATE DATABASE
	BACKUP;
	
	
/* Escolhendo um Banco de Dados */
USE
	BACKUP;
	
	
/* Criando uma Tabela */
CREATE TABLE BKP_PRODUTO (
	IDBACKUP INT PRIMARY KEY AUTO_INCREMENT,
	IDPRODUTO INT,
	NOME VARCHAR(30),
	VALOR_ORIGINAL FLOAT(10,2),
	VALOR_ALTERADO FLOAT(10,2),
	DATA DATETIME,
	USUARIO VARCHAR(30),
	EVENTO CHAR(1)
);


/* Alterando um Dado da Tabela */
UPDATE 
	PRODUTO
SET 
	VALOR = 100.00
WHERE
	IDPRODUTO = 4;
	
	
/* Criando uma Trigger */
DELIMITER $$
CREATE TRIGGER	
	AUDIT_PROD
AFTER UPDATE ON
	PRODUTO
FOR EACH ROW
BEGIN
	INSERT INTO 
		BACKUP.BKP_PRODUTO
	VALUES(
		NULL,
		OLD.IDPRODUTO,
		OLD.NOME,
		OLD.VALOR,
		NEW.VALOR,
		NOW(),
		CURRENT_USER(),
		'U');
END
$$

DELIMITER ;


/* Alterando um Dado da Tabela */
UPDATE
	PRODUTO
SET
	VALOR = 110.00
WHERE
	IDPRODUTO = 4;